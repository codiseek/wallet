{% load static %}

<div class="mobile-tab" id="tab-panel">
    <div class="mobile-section">
        <div class="mobile-content">


                 <!-- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±–ª–æ–∫ "–†–µ–∑–µ—Ä–≤ –∏ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è" —Å –Ω–æ–≤—ã–º –¥–∏–∑–∞–π–Ω–æ–º -->

    <h2 class="text-lg font-bold mb-4 flex items-center">
        <i class="fa-solid fa-sliders text-blue-400 mr-2"></i>
 <span >–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
    </h2>
    

            
<!-- Ultra Minimal Apple Style -->
<div class="bg-gray-800/30 rounded-2xl p-5 mb-6 border border-gray-700/20">
    <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
            <!-- –ê–≤–∞—Ç–∞—Ä -->
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-slate-600 to-slate-500 flex items-center justify-center">
                <i class="fas fa-user text-white"></i>
            </div>
            
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div>
                <h2 class="text-lg font-medium text-white mb-1">{{ user.username }}</h2>
                <p class="text-sm text-gray-400">
                    ID {{ user.id }} ‚Ä¢ {{ user.date_joined|date:"d.m.Y" }}
                </p>
            </div>
        </div>

        
        
        <!-- –ï–¥–∏–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é -->
<!-- –í –∫–∞—Ä—Ç–æ—á–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
<div class="relative">
    <button class="user-menu-btn w-9 h-9 rounded-lg bg-gray-700/50 hover:bg-gray-600/50 flex items-center justify-center transition-colors">
    <i class="fas fa-ellipsis-h text-gray-400 text-sm"></i>
</button>
    
    <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div id="userMenu" class="hidden absolute right-0 top-12 w-48 bg-gray-800/95 backdrop-blur-lg rounded-xl border border-gray-700/50 shadow-2xl py-2 z-50">
        <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
        <button onclick="openProfileModalFromMenu()" 
                class="w-full flex items-center space-x-3 px-3 py-3 rounded-lg hover:bg-blue-500/20 text-gray-200 hover:text-white transition-all duration-200 group text-left mx-2">
            <div class="w-9 h-9 bg-blue-500/20 rounded-lg flex items-center justify-center group-hover:bg-blue-500 transition-colors flex-shrink-0">
                <i class="fas fa-user-edit text-blue-400 text-sm group-hover:text-white"></i>
            </div>
            <span class="text-lg font-medium whitespace-nowrap">–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
        
        <div class="border-t border-gray-700/50 my-1 mx-2"></div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ -->
        <a href="{% url 'logout' %}" 
           class="w-full flex items-center space-x-3 px-3 py-3 rounded-lg hover:bg-red-500/20 text-gray-200 hover:text-white transition-all duration-200 group text-left mx-2">
            <div class="w-9 h-9 bg-red-500/20 rounded-lg flex items-center justify-center group-hover:bg-red-500 transition-colors flex-shrink-0">
                <i class="fas fa-sign-out-alt text-red-400 text-sm group-hover:text-white"></i>
            </div>
            <span class="text-lg font-medium whitespace-nowrap">–í—ã–π—Ç–∏</span>
        </a>
    </div>
</div>
    </div>
</div>


<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—Ñ–∏–ª–µ -->
<div id="profileNotification" class="hidden mb-4"></div>



{% if user.is_staff %}
<!-- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
<div class="bg-red-900/20 rounded-xl p-4 mb-6 border border-red-500/30 admin-panel">
    <h3 class="font-semibold text-white mb-4 flex items-center">
        <i class="fas fa-shield-alt mr-2 text-yellow-400"></i>
        <span>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
    </h3>
    
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ -->
    <button onclick="toggleAdminUsersModal()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-4 rounded-xl transition-all duration-200 transform hover:scale-[1.02] flex items-center justify-center space-x-3 mb-4">
        <i class="fas fa-users text-lg"></i>
        <span class="text-base font-medium">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</span>
    </button>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="grid grid-cols-3 gap-3 mb-4">
        <div class="bg-white/10 rounded-lg p-3 text-center">
            <div id="totalUsersCount" class="text-2xl font-bold text-green-400">0</div>
            <div class="text-gray-300 text-xs mt-1">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        </div>
        <div class="bg-white/10 rounded-lg p-3 text-center">
            <div id="newUsersWeekCount" class="text-2xl font-bold text-blue-400">0</div>
            <div class="text-gray-300 text-xs mt-1">–ù–æ–≤—ã—Ö –∑–∞ –Ω–µ–¥–µ–ª—é</div>
        </div>
        <div class="bg-white/10 rounded-lg p-3 text-center">
            <div id="activeTodayCount" class="text-2xl font-bold text-purple-400">0</div>
            <div class="text-gray-300 text-xs mt-1">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è</div>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
    <div class="bg-black/30 rounded-lg p-3 border border-white/10">
        <h4 class="text-white font-medium mb-2 flex items-center text-sm">
            <i class="fas fa-clock mr-2 text-gray-400"></i>
            <span>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</span>
        </h4>
        
        <div id="recentUsersList">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            <div class="text-center py-4 text-gray-400">
                <i class="fas fa-spinner animate-spin mr-2"></i>
                <span>–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
        </div>
    </div>
</div>

{% endif %}

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
<div id="adminUsersModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[500] backdrop-blur-sm hidden">
    <div class="bg-gray-800 rounded-2xl w-11/12 max-w-2xl max-h-[80vh] overflow-hidden border  border-gray-600/50 flex flex-col">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
        <div class="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900/50 flex-shrink-0">
            <div>
                <h3 class="text-lg font-bold text-white flex items-center">
                    <i class="fas fa-users mr-2 text-purple-400"></i>
                    <span>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
                </h3>
            </div>
            <button onclick="toggleAdminUsersModal()" class="text-gray-400 hover:text-white p-2 rounded-full hover:bg-gray-700 transition-colors">
                <i class="fas fa-times text-lg"></i>
            </button>
        </div>
        
        <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
        <div class="p-4 border-b border-gray-700 bg-gray-750 flex-shrink-0">
            <div class="flex space-x-3">
                <div class="flex-1 relative">
                    <input 
                        type="text" 
                        id="usersSearchInput"
                        placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ email..." 
                        data-translate-placeholder="panel.search_users"
                        class="w-full bg-gray-700 border border-gray-600 rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-400 focus:border-purple-500 focus:ring-0 outline-none transition-all"
                        oninput="searchUsers()"
                    >
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
                <button class="bg-purple-600 hover:bg-purple-500 text-white px-4 rounded-xl transition-colors flex items-center space-x-2">
                    <i class="fas fa-filter"></i>
                    <span>–§–∏–ª—å—Ç—Ä—ã</span>
                </button>
            </div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π -->
        <div class="flex-1 overflow-y-auto">
            <!-- –õ–æ–∞–¥–µ—Ä -->
            <div id="usersListLoader" class="p-8 text-center">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-2 border-purple-500 border-t-transparent"></div>
                <p class="text-gray-400 mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>
            </div>
            
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
            <div id="usersListContent" class="hidden">
                <div id="usersListContainer" class="p-4">
                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ" -->
                <div class="p-4 border-t border-gray-700">
                    <button 
                        id="loadMoreUsersBtn" 
                        onclick="loadMoreUsers()"
                        class="w-full bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-xl transition-colors hidden"
                    >
                        <i class="fas fa-plus mr-2"></i>
                        <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Ñ—É—Ç–µ—Ä–µ -->
        <div class="p-4 border-t border-gray-700 bg-gray-900/30 flex-shrink-0">
            <div class="flex justify-between items-center text-sm">
                <div class="text-gray-400">
                    <i class="fas fa-info-circle mr-1"></i>
                    <span>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</span> <span id="modalTotalUsers" class="text-white font-semibold">0</span>
                </div>
                <button class="text-purple-400 hover:text-purple-300 text-sm flex items-center space-x-1">
                    <i class="fas fa-download"></i>
                    <span>–≠–∫—Å–ø–æ—Ä—Ç</span>
                </button>
            </div>
        </div>
    </div>
</div>



{% load i18n %}

<!-- –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ -->
<div class="bg-gray-800/60 rounded-xl p-4 mb-6 border border-gray-600/50">
  <div class="flex items-center justify-between mb-3">
    <div class="flex items-center space-x-2">
      <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center">
        <i class="fas fa-globe text-purple-400 text-sm"></i>
      </div>
      <h3 class="text-base font-semibold text-gray-200">{% trans "–Ø–∑—ã–∫" %}</h3>
    </div>
    
    {% get_current_language as LANGUAGE_CODE %}
    <span id="currentLanguage" class="text-sm text-purple-400 font-medium">
      {% if LANGUAGE_CODE == 'ru' %}{% trans "–†—É—Å—Å–∫–∏–π" %}
      {% elif LANGUAGE_CODE == 'en' %}{% trans "English" %}
      {% elif LANGUAGE_CODE == 'kg' %}{% trans "–ö—ã—Ä–≥—ã–∑—á–∞" %}
      {% else %}{% trans "–†—É—Å—Å–∫–∏–π" %}{% endif %}
    </span>
  </div>

  <p class="text-sm text-gray-400 mb-3">{% trans "–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞." %}</p>

  <!-- –§–æ—Ä–º–∞ —Å–º–µ–Ω—ã —è–∑—ã–∫–∞ -->
  <form action="{% url 'update_language' %}" method="post" class="grid grid-cols-3 gap-2">
    {% csrf_token %}
    <input type="hidden" name="next" value="{{ request.path }}">

    <button type="submit" name="language" value="ru"
      class="flex items-center justify-center py-3 px-4 rounded-lg transition-all duration-200 border {% if LANGUAGE_CODE == 'ru' %}border-2 border-purple-500 bg-purple-500/10{% else %}border-gray-600 hover:bg-gray-700{% endif %}">
      <span class="text-white text-sm">{% trans "–†—É—Å—Å–∫–∏–π" %}</span>
    </button>
    
    <button type="submit" name="language" value="en"
      class="flex items-center justify-center py-3 px-4 rounded-lg transition-all duration-200 border {% if LANGUAGE_CODE == 'en' %}border-2 border-purple-500 bg-purple-500/10{% else %}border-gray-600 hover:bg-gray-700{% endif %}">
      <span class="text-white text-sm">{% trans "English" %}</span>
    </button>
    
    <button type="submit" name="language" value="kg"
      class="flex items-center justify-center py-3 px-4 rounded-lg transition-all duration-200 border {% if LANGUAGE_CODE == 'kg' %}border-2 border-purple-500 bg-purple-500/10{% else %}border-gray-600 hover:bg-gray-700{% endif %}">
      <span class="text-white text-sm">{% trans "–ö—ã—Ä–≥—ã–∑—á–∞" %}</span>
    </button>
  </form>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–µ—Ä–µ–≤–æ–¥–∞ -->
  <div class="mt-4 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
    <div class="flex items-start space-x-3">
      <div class="w-5 h-5 rounded-full bg-yellow-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
        <i class="fas fa-info text-yellow-400 text-xs"></i>
      </div>
      <div class="flex-1">
        <p class="text-yellow-400 text-xs font-medium mb-1">{% trans "–ü–µ—Ä–µ–≤–æ–¥ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ" %}</p>
        <p class="text-yellow-300/80 text-xs leading-relaxed">
          {% trans "–ú—ã –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –ø–µ—Ä–µ–≤–æ–¥–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –º–æ–≥—É—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ü–µ—Ä–µ–≤–æ–¥ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω –≤ –±–ª–∏–∂–∞–π—à–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö." %}
        </p>
      </div>
    </div>
  </div>
</div>

            <!-- –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ –≤–∞–ª—é—Ç—ã -->
            <div class="bg-gray-800/60 rounded-xl p-4 mb-6 border border-gray-600/50">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center">
                            <i class="fas fa-money-bill-wave text-green-400 text-sm"></i>
                        </div>
                         <h3 class="text-base font-semibold text-gray-200">–í–∞–ª—é—Ç–∞</h3>
                    </div>
                    <span id="currentCurrency" class="text-sm text-green-400 font-medium">
                        {% if user_currency == 'c' %}<span>—Å–æ–º</span>
            {% elif user_currency == 'r' %}<span>—Ä—É–±–ª—å</span>
            {% elif user_currency == '$' %}<span>–¥–æ–ª–ª–∞—Ä</span>
            {% elif user_currency == '‚Ç¨' %}<span>–µ–≤—Ä–æ</span>
            {% else %}<span>—Å–æ–º</span>{% endif %}
                    </span>
                </div>

                <p class="text-sm text-gray-400 mb-3">
        –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—É–º–º.
    </p>

                <div class="grid grid-cols-2 gap-2">
        <button class="currency-btn flex items-center justify-center py-3 px-4 rounded-lg bg-gray-800 hover:bg-gray-700 transition-all duration-200 border {% if user_currency == 'c' %}border-2 border-green-500 bg-green-500/10{% else %}border-gray-600{% endif %}" data-currency="c" data-translate-title="currencies.som" title="–°–æ–º">
            <i class="fa-solid fa-c text-white text-lg"></i>
        </button>
        <button class="currency-btn flex items-center justify-center py-3 px-4 rounded-lg bg-gray-800 hover:bg-gray-700 transition-all duration-200 border {% if user_currency == 'r' %}border-2 border-green-500 bg-green-500/10{% else %}border-gray-600{% endif %}" data-currency="r" data-translate-title="currencies.ruble" title="–†—É–±–ª—å">
            <i class="fas fa-ruble-sign text-white text-lg"></i>
        </button>
        <button class="currency-btn flex items-center justify-center py-3 px-4 rounded-lg bg-gray-800 hover:bg-gray-700 transition-all duration-200 border {% if user_currency == '$' %}border-2 border-green-500 bg-green-500/10{% else %}border-gray-600{% endif %}" data-currency="$" data-translate-title="currencies.dollar" title="–î–æ–ª–ª–∞—Ä">
            <i class="fas fa-dollar-sign text-white text-lg"></i>
        </button>
        <button class="currency-btn flex items-center justify-center py-3 px-4 rounded-lg bg-gray-800 hover:bg-gray-700 transition-all duration-200 border {% if user_currency == '‚Ç¨' %}border-2 border-green-500 bg-green-500/10{% else %}border-gray-600{% endif %}" data-currency="‚Ç¨" data-translate-title="currencies.euro" title="–ï–≤—Ä–æ">
            <i class="fas fa-euro-sign text-white text-lg"></i>
        </button>
    </div>
</div>

          <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ —Ä–µ–∑–µ—Ä–≤–∞ -->
<div class="bg-gray-800/60 rounded-xl p-4 mb-6 border border-gray-600/50">
    <div class="flex items-center justify-between mb-3">
        <div class="flex items-center space-x-2">
            <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center">
                <i class="fas fa-piggy-bank text-blue-400 text-sm"></i>
            </div>
            <h3 class="text-base font-semibold text-gray-200">–†–µ–∑–µ—Ä–≤</h3>
        </div>
        <span id="currentReservePercent" class="text-sm text-blue-400 font-medium">{{ reserve_percentage }}%</span>
    </div>

    <p class="text-sm text-gray-400 mb-3">
        –£–∫–∞–∂–∏—Ç–µ, —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –æ—Ç –¥–æ—Ö–æ–¥–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤ —Ä–µ–∑–µ—Ä–≤.
    </p>

    <div class="flex items-center space-x-3 mb-4">
        <input
            type="number"
            id="reservePercentageInput"
            min="0"
            max="100"
            class="w-24 bg-gray-800 border border-gray-700 rounded-lg p-2 text-center text-white text-lg font-semibold focus:border-blue-500 focus:ring-0 outline-none transition-all"
            value="{{ reserve_percentage }}" 
        >
        <button
            id="saveReserveBtn"
            class="flex-1 bg-blue-600 hover:bg-blue-500 text-white px-3 w-full py-3 rounded-lg text-sm font-medium transition-all"
        >
            <i class="fas fa-save mr-2"></i>
            <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
        </button>
    </div>

               <!-- –ë–ª–æ–∫ –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–∞ -->
    <div class="pt-4 border-t border-gray-600/50">
        <div class="flex items-center justify-between mb-3">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center">
                    <i class="fas fa-bullseye text-purple-400 text-sm"></i>
                </div>
                <h3 class="text-base font-semibold text-gray-200">–¶–µ–ª–µ–≤–æ–π —Ä–µ–∑–µ—Ä–≤</h3>
            </div>
            <span id="currentTargetReserve" class="text-sm text-purple-400 font-medium">{{ target_reserve|floatformat:0 }} <span>—Å–æ–º</span></span>
        </div>

        <p class="text-sm text-gray-400 mb-3">
            –£–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ –Ω–∞–∫–æ–ø–∏—Ç—å.
        </p>

        <div class="flex items-center space-x-3">
            <input
                type="number"
                id="targetReserveInput"
                min="0"
                step="1000"
                class="w-24 bg-gray-800 border border-gray-700 rounded-lg p-2 text-center text-white text-lg font-semibold focus:border-purple-500 focus:ring-0 outline-none transition-all"
                value="{{ target_reserve|floatformat:0 }}"
            >
            <button
                id="saveTargetReserveBtn"
                class="flex-1 bg-blue-600 hover:bg-blue-500 text-white px-3 w-full py-3 rounded-lg text-sm font-medium transition-all"
            >
                <i class="fas fa-save mr-2"></i>
                <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
            </button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞
    const languageButtons = document.querySelectorAll('button[name="language"]');
    
    languageButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();

            const form = this.closest('form');
            const formData = new FormData(form);
            const selectedLanguage = this.value;

            // üëá –í–∞–∂–Ω–æ: –¥–æ–±–∞–≤–ª—è–µ–º —è–∑—ã–∫ –≤—Ä—É—á–Ω—É—é, –∏–Ω–∞—á–µ –æ–Ω –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
            formData.append('language', selectedLanguage);

            console.log('Changing language to:', selectedLanguage);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const currentLanguage = document.getElementById('currentLanguage');
            const originalText = currentLanguage.textContent;
            currentLanguage.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞
            languageButtons.forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
            });

            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Server response:', data);

                if (data.success) {
                    const languageNames = {
                        'ru': '–†—É—Å—Å–∫–∏–π',
                        'en': 'English',
                        'kg': '–ö—ã—Ä–≥—ã–∑—á–∞'
                    };
                    currentLanguage.textContent = data.language_name || languageNames[selectedLanguage] || selectedLanguage;

                    if (window.showSuccessNotification) {
                        showSuccessNotification(data.message || '–Ø–∑—ã–∫ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!');
                    }

                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
                    setTimeout(() => {
                        window.location.reload();
                    }, 500);
                } else {
                    currentLanguage.textContent = originalText;
                    if (window.showErrorNotification) {
                        showErrorNotification(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞');
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                currentLanguage.textContent = originalText;
                if (window.showErrorNotification) {
                    showErrorNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞');
                }
            })
            .finally(() => {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                languageButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                });
            });
        });
    });
});
</script>

        
<script>
// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∞
let isImporting = false;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
function exportData() {
    if (isImporting) return;
    
    console.log('Export started...');
    
    if (window.showLoadingNotification) {
        showLoadingNotification('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞...');
    }
    
    fetch('/export-data/', {
        method: 'GET',
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ' + response.status);
        }
        return response.blob();
    })
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = `backup_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        
        if (window.showSuccessNotification) {
            showSuccessNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
        }
    })
    .catch(error => {
        console.error('Export error:', error);
        if (window.showErrorNotification) {
            showErrorNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
        }
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
function importData() {
    if (isImporting) {
        console.log('Import already in progress');
        return;
    }
    
    console.log('Import started...');
    
    // –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª–æ–≤—ã–π input
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = '.json';
    fileInput.style.display = 'none';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è change
    fileInput.addEventListener('change', function(event) {
        handleFileImport(event, fileInput);
    });
    
    document.body.appendChild(fileInput);
    fileInput.click();
    
    // –£–¥–∞–ª—è–µ–º input –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    setTimeout(() => {
        if (document.body.contains(fileInput)) {
            document.body.removeChild(fileInput);
        }
    }, 1000);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
function handleFileImport(event, fileInput) {
    console.log('File selected for import');
    
    const file = event.target.files[0];
    if (!file) {
        console.log('No file selected');
        return;
    }
    
    console.log('Selected file:', file.name, file.size, file.type);
    
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞
    if (!confirm('–í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
        console.log('Import cancelled by user');
        return;
    }

    console.log('User confirmed import');
    
    // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É –∏–º–ø–æ—Ä—Ç–∞
    const importBtn = document.getElementById('importBtn');
    console.log('Import button found:', !!importBtn);
    
    if (importBtn) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        const originalHTML = importBtn.innerHTML;
        const originalClasses = importBtn.className;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
        importBtn.innerHTML = `
            <i class="fas fa-spinner fa-spin text-2xl"></i>
            <span class="font-medium text-sm">–ò–º–ø–æ—Ä—Ç...</span>
            <span class="text-xs text-blue-200 opacity-80">–ò–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞</span>
        `;
        importBtn.className = originalClasses.replace('bg-green-600', 'bg-blue-600') + ' cursor-not-allowed';
        importBtn.disabled = true;
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –∏–º–ø–æ—Ä—Ç–∞
        isImporting = true;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        if (window.showLoadingNotification) {
            showLoadingNotification('–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥');
        }
        
        const formData = new FormData();
        formData.append('backup_file', file);
        
        console.log('Sending import request...');
        
        fetch('/import-data/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            }
        })
        .then(response => {
            console.log('Import response status:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('Import response data:', data);
            
            if (data.success) {
                // –£—Å–ø–µ—Ö
                importBtn.innerHTML = `
                    <i class="fas fa-check text-2xl"></i>
                    <span class="font-medium text-sm">–£—Å–ø–µ—à–Ω–æ!</span>
                    <span class="text-xs text-green-200 opacity-80">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞...</span>
                `;
                importBtn.className = originalClasses.replace('bg-green-600', 'bg-green-700') + ' cursor-not-allowed';
                
                if (window.showSuccessNotification) {
                    showSuccessNotification(data.message || '–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                }
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } else {
                // –û—à–∏–±–∫–∞
                throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
            }
        })
        .catch(error => {
            console.error('Import error:', error);
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å –æ—à–∏–±–∫–æ–π
            importBtn.innerHTML = `
                <i class="fas fa-times text-2xl"></i>
                <span class="font-medium text-sm">–û—à–∏–±–∫–∞</span>
                <span class="text-xs text-red-200 opacity-80">–ù–∞–∂–º–∏—Ç–µ —Å–Ω–æ–≤–∞</span>
            `;
            importBtn.className = originalClasses.replace('bg-green-600', 'bg-red-600');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
            if (window.showErrorNotification) {
                showErrorNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                importBtn.innerHTML = originalHTML;
                importBtn.className = originalClasses;
                importBtn.disabled = false;
                isImporting = false;
            }, 3000);
        })
        .finally(() => {
            // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª–æ–≤—ã–π input
            if (fileInput && document.body.contains(fileInput)) {
                document.body.removeChild(fileInput);
            }
        });
    } else {
        console.error('Import button not found');
        if (window.showErrorNotification) {
            showErrorNotification('–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∏–º–ø–æ—Ä—Ç–∞');
        }
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('Backup functions loaded');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–Ω–æ–ø–∫–∏ –Ω–∞–π–¥–µ–Ω—ã
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    
    console.log('Export button found:', !!exportBtn);
    console.log('Import button found:', !!importBtn);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ onclick
    if (exportBtn && !exportBtn.onclick) {
        exportBtn.addEventListener('click', exportData);
    }
    if (importBtn && !importBtn.onclick) {
        importBtn.addEventListener('click', importData);
    }
});

// –§—É–Ω–∫—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–µ—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã)
if (typeof showSuccessNotification === 'undefined') {
    window.showSuccessNotification = function(message) {
        alert('SUCCESS: ' + message);
    };
}

if (typeof showErrorNotification === 'undefined') {
    window.showErrorNotification = function(message) {
        alert('ERROR: ' + message);
    };
}

if (typeof showLoadingNotification === 'undefined') {
    window.showLoadingNotification = function(message) {
        console.log('LOADING: ' + message);
    };
}
</script>


<!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ -->
<div class="bg-zinc-800/60 rounded-2xl p-5 mb-6 border border-gray-700/50 shadow-lg">
  <h3 class="font-semibold text-white mb-4 flex items-center">
    <i class="fas fa-database mr-2 text-blue-400"></i>
    <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</span>
  </h3>

  <div class="grid grid-cols-2 gap-4 mb-4">
    <!-- –ö–Ω–æ–ø–∫–∞ –≠–∫—Å–ø–æ—Ä—Ç -->
    <button 
      id="exportBtn" 
      onclick="exportData()" 
      class="group bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white py-5 rounded-xl transition-all duration-300 transform hover:scale-[1.03] flex flex-col items-center justify-center shadow-md shadow-blue-900/20"
    >
      <i class="fas fa-download text-2xl mb-1 group-hover:scale-110 transition-transform"></i>
      <span class="font-semibold text-sm tracking-wide">–≠–∫—Å–ø–æ—Ä—Ç</span>
      <span class="text-xs text-blue-200 opacity-80 mt-0.5">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</span>
    </button>

    <!-- –ö–Ω–æ–ø–∫–∞ –ò–º–ø–æ—Ä—Ç -->
    <button 
      id="importBtn" 
      onclick="importData()" 
      class="group bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white py-5 rounded-xl transition-all duration-300 transform hover:scale-[1.03] flex flex-col items-center justify-center shadow-md shadow-green-900/20"
    >
      <i class="fas fa-upload text-2xl mb-1 group-hover:scale-110 transition-transform"></i>
      <span class="font-semibold text-sm tracking-wide">–ò–º–ø–æ—Ä—Ç</span>
      <span class="text-xs text-green-200 opacity-80 mt-0.5">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</span>
    </button>
  </div>

  <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ -->
  <input type="file" id="importFileInput" accept=".json" class="hidden">

  <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–æ—Ä–º–∞—Ç–µ -->
  <div class="text-gray-400 text-xs border-t border-gray-700/50 pt-3">
    <i class="fas fa-info-circle text-blue-400 mr-1"></i>
    <span>–≠–∫—Å–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ</span> <span class="text-blue-300 font-medium">JSON</span>.  
    <span>–ò–º–ø–æ—Ä—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ</span> <span class="text-green-300 font-medium">JSON-—Ñ–∞–π–ª—ã</span>, <span>—Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —ç–∫—Å–ø–æ—Ä—Ç.</span>
  </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ -->
<div class="text-center mt-6 mb-6">
    <button class="text-blue-400 hover:text-blue-300 text-sm flex items-center justify-center space-x-1 mx-auto">
        <i class="fas fa-headset"></i>
        <span>–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</span>
    </button>
</div>
        </div>
    </div>
</div>
        </div></div>



