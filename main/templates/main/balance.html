{% load static %}
{% load i18n %}
      
<!-- Основной баланс — обновлённый дизайн -->
<div class="relative bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-2xl p-5 mb-4 -mt-2 border border-blue-800/30 shadow-lg overflow-hidden">
    <!-- Большая фоновая иконка валюты -->
    <i id="balanceCurrencyIcon" class="fas 
        {% if user_currency == 'c' %}fa-c
        {% elif user_currency == 'r' %}fa-ruble-sign
        {% elif user_currency == '$' %}fa-dollar-sign
        {% elif user_currency == '€' %}fa-euro-sign
        {% elif user_currency == '₸' %}fa-tenge-sign
        {% elif user_currency == '₴' %}fa-hryvnia-sign
        {% else %}fa-dollar-sign{% endif %} 
        text-[100px] text-blue-800/20 absolute top-3 right-4"></i>

    <div class="flex justify-between items-start relative z-10">
        <!-- Левая часть -->
        <div>
            <p class="text-sm text-gray-300 mb-1">{% trans "Текущий баланс" %}</p>
            <p class="text-3xl font-bold text-white">
                <span id="totalBalance" data-raw-value="{{ total }}">0</span>
                <span class="currency-symbol">с</span>
            </p>

            <!-- Резерв -->
            <div class="flex items-center space-x-2">
                <span class="text-sm text-gray-300">{% trans "Резерв" %}:</span>
                <span class="text-blue-400 font-semibold text-lg" id="reserveAmount" data-raw-value="{{ current_reserve }}">0</span>
                <span class="currency-symbol text-blue-400 font-semibold text-lg">с</span>
            </div>
        </div>
    </div>

    <!-- Нижний блок — Доходы, Расходы, Шкала -->
    <div class="mt-2 relative z-10">
        <div class="flex justify-between items-end mb-2">
            <div class="text-left">
                <p class="text-xs text-gray-400 mb-1">{% trans "Доходы" %}</p>
                <p class="text-green-400 font-semibold">
                    <span id="monthIncome">0</span> <span class="currency-symbol">с</span>
                </p>
            </div>
            <div class="text-right">
                <p class="text-xs text-gray-400 mb-1">{% trans "Расходы" %}</p>
                <p class="text-red-400 text-sm font-semibold">
                    <span id="monthExpense" data-raw-value="{{ expense }}">0</span>
                    <span class="currency-symbol">с</span>
                </p>
            </div>
        </div>

<!-- Прогресс-бар для доходов/расходов -->
<div class="w-full bg-gray-800 p-[2px] rounded-full">
  <div class="bg-gray-800 rounded-full h-2 overflow-hidden">
    <div id="balanceProgressBar" class="h-2">
      <!-- Прогресс-бар будет обновляться динамически -->
      <div class="bg-gray-600 h-2 rounded-full w-full"></div>
    </div>
  </div>
</div>

    </div>
</div>

<script>
// Функция для преобразования чисел из Django формата в JavaScript
function djangoToJsNumber(djangoNumber) {
    if (typeof djangoNumber === 'number') return djangoNumber;
    if (typeof djangoNumber === 'string') {
        // Заменяем запятые на точки и убираем пробелы (разделители тысяч)
        return parseFloat(djangoNumber.replace(',', '.').replace(/\s/g, ''));
    }
    return 0;
}

// Инициализация баланса при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    // Безопасно преобразуем числа из Django в JavaScript формат
    window.initialBalances = {
        total: djangoToJsNumber({{ total|default:0 }}),
        income: djangoToJsNumber({{ income|default:0 }}),
        expense: djangoToJsNumber({{ expense|default:0 }}),
        total_reserve: djangoToJsNumber({{ current_reserve|default:0 }}),
        monthly_reserve: djangoToJsNumber({{ monthly_reserve|default:0 }})
    };
    
    window.initialReservePercentage = djangoToJsNumber({{ reserve_percentage|default:10 }});
    window.initialTargetReserve = djangoToJsNumber({{ target_reserve|default:0 }});
    
    
    // Обновляем отображение баланса
    if (typeof updateBalanceDisplay === 'function') {
        updateBalanceDisplay();
    }
});


</script>