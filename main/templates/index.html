{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- PWA мета-теги -->
    <meta name="application-name" content="coinza">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="coinza">
    <meta name="description" content="Приложение для учета личных финансов">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#000b21">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="theme-color" content="#000b21">


    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="{% static 'main/icons/icon-152x152.png' %}">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'main/icons/icon-152x152.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'main/icons/icon-192x192.png' %}">
    <link rel="apple-touch-icon" sizes="167x167" href="{% static 'main/icons/icon-152x152.png' %}">

    <!-- Manifest -->
    <link rel="manifest" href="{% static 'main/manifest.json' %}">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'main/icons/icon-32x32.png' %}" sizes="32x32">
    <link rel="icon" type="image/png" href="{% static 'main/icons/icon-16x16.png' %}" sizes="16x16">

    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Coinza - Управляй финансами просто!</title>
    <meta name="theme-color" content="#0f172a">

    <!-- CDN и локальные стили -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'main/style.css' %}">
</head>

<body class="gradient-bg text-gray-100 min-h-screen">
    <form style="display:none;">{% csrf_token %}</form>

    <!-- Основной контейнер приложения -->
    <div class="app-container">

{% include "main/header.html" %}


<!-- Главная вкладка -->
        <div class="mobile-tab active" id="tab-home">
           <div class="mobile-section">
                <div class="mobile-content"> 
{% include "main/balance.html" %}
{% include "main/category_slider.html" %}
{% include "main/transaction_history.html" %}

 </div></div></div>
{% include "main/debt_page.html" %}
{% include "main/todo_page.html" %}
{% include "main/category_page.html" %}
{% include "main/stats_page.html" %}      
{% include "main/note_page.html" %}
{% include "main/panel_page.html" %}


                    
</div>
        


{% include "main/navigation.html" %}


    <!-- Подключение модалок -->



    {% include "includes/modals/notification.html" %}

    

    {% if user.is_staff %}
    {% include "includes/modals/create_notification.html" %}
    {% endif %}
    {% include "includes/modals/change_password_regular.html" %}
        {% include "includes/modals/profile.html" %}
    {% include "includes/modals/change_password_first.html" %}
    {% include "includes/modals/transaction_detail.html" %}
    {% include "includes/modals/transaction.html" %}
    {% include "includes/modals/category_selection.html" %}
    {% include "includes/modals/category_detail.html" %}
    {% include "includes/modals/category.html" %}
    {% include "includes/modals/note.html" %}
    {% include "includes/modals/view_note.html" %}
    {% include "includes/modals/open_notif.html" %}
    {% include "includes/modals/todo.html" %}
    {% include "includes/modals/chat.html" %}
    {% include "includes/modals/debt.html" %}


<script>
    // Передаем текущий язык из Django в JavaScript
    window.userLanguage = '{{ user_language }}' || 'ru';
</script>

<script>
    // Передаем текущую валюту из Django в JavaScript
    window.currentCurrency = '{{ user_currency }}' || 'c';
    console.log('Текущая валюта из Django:', '{{ user_currency }}');
</script>

<script>
    // Определяем isAdmin для JavaScript
    window.isAdmin = {% if user.is_staff %}true{% else %}false{% endif %};
</script>



<!-- index.html - обновляем блок с балансом -->
<script>
    window.initialBalances = {
        total: {{ total|default:0 }},
        income: {{ income|default:0 }},
        expense: {{ expense|default:0 }},
        total_reserve: {{ current_reserve|default:0 }},
        monthly_reserve: {{ monthly_reserve|default:0 }}  // добавляем месячный резерв
    };
    window.initialReservePercentage = {{ reserve_percentage|default:0 }};
    window.initialTargetReserve = {{ target_reserve|default:0 }};
</script>

<!-- Подключение Tailwind и JS -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="/static/main/utils.js"></script>
<script src="/static/main/modals.js"></script>
<script src="/static/main/notification-logo.js"></script>
<script src="/static/main/currency.js"></script>
<script src="/static/main/debt.js"></script>
<script src="/static/main/balance.js"></script>
<script src="/static/main/categories.js"></script>
<script src="/static/main/categories-modal.js"></script>
<script src="/static/main/notes.js"></script>  
<script src="/static/main/admin.js"></script>     
<script src="/static/main/transactions.js"></script>
<script src="/static/main/savings.js"></script>
<script src="/static/main/navigation.js"></script>
<script src="/static/main/admin.js"></script> 
<script src="/static/main/profile.js"></script> 
<script src="/static/main/todo.js"></script> 
<script src="/static/main/app.js"></script>

   

  <script>

  
    // Передаем категории из Django в JavaScript
    window.categories = [
        {% for cat in categories %}
        {
            id: "{{ cat.id }}",
            name: "{{ cat.name|escapejs }}"
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];

    // Передача URL из Django в JavaScript
    window.ADD_TRANSACTION_URL = "{% url 'add_transaction' %}";
    window.STATIC_URL = "{% static '' %}";

  

    // Флаг нового пользователя для показа приветствия
    window.isNewUser = {% if is_new_user %}true{% else %}false{% endif %};


    // Инициализация при загрузке страницы
    document.addEventListener("DOMContentLoaded", function() {


        
        
        // Скрываем пустое состояние для фильтрованных категорий
        const emptyStateFiltered = document.getElementById('emptyStateFiltered');
        if (emptyStateFiltered) {
            emptyStateFiltered.classList.add('hidden');
        }
        
        // Инициализация системы фильтрации
        if (typeof window.initTransactionFilter === 'function') {

            window.initTransactionFilter();
        } else {
            console.error('Функция initTransactionFilter не найдена');
        }
        
        // Инициализация вкладок категорий
        if (typeof window.updateCategoryTabsHandlers === 'function') {
            window.updateCategoryTabsHandlers();
        }
    });
</script>

    

</body>
</html>